{"version":3,"file":"main.js","sources":["../src/state/store.js","../src/state/container.js","../src/main.js"],"sourcesContent":["const makeSubject = () => {\n  const observers = new Map();\n  let idPtr = 0;\n  return {\n    subscribe: (callback) => {\n      const id = idPtr;\n      idPtr++;\n      observers.set(id, callback);\n      return () => observers.delete(id);\n    },\n    next: (...args) => {\n      observers.forEach(callback => callback(...args));\n    }\n  };\n};\n\nexport default (store = {}) => {\n  const state$ = makeSubject();\n\n  return {\n    subscribe: func => state$.subscribe(func),\n    set: (mountPoint, payload) => {\n      store[mountPoint] = payload;\n      state$.next();\n    },\n    get: mountPoint => store[mountPoint]\n  };\n};\n","import preact from 'preact';\n\nexport default class Container extends preact.Component {\n  constructor() {\n    super();\n    this.update = this.update.bind(this);\n  }\n\n  componentWillMount() {\n    this.unsubscribe = this.props.store.subscribe(this.update);\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe();\n  }\n\n  update() {\n    this.forceUpdate();\n  }\n\n  render({ children, store }) {\n    return (\n      <div>\n        {\n          children.map(componentFunc => componentFunc(store))\n        }\n      </div>\n    );\n  }\n}\n\nconst perf = (Component, keys) =>\n  class Perf extends preact.Component {\n    shouldComponentUpdate(nextProps) {\n      return keys.some(key => nextProps[key] !== this.props[key]);\n    }\n\n    render() {\n      return <Component {...this.props} />;\n    }\n  };\n\nexport const mapper = (propMappings={}, actionMappings={}) =>\n  Component => {\n    const PerfComponent = perf(Component, Object.keys(propMappings));\n    return ({ store, ...props }) => {\n      const mapped = Object.assign({},\n        ...Object.entries(propMappings).map(([key, func]) => ({ [key]: func(store) }))\n      );\n\n      const actions = Object.assign({},\n        ...Object.entries(actionMappings).map(([key, func]) => ({ [key]: (...args) => func(store, ...args) }))\n      );\n\n      return <PerfComponent {...mapped} {...actions} {...props} />;\n    };\n  };\n","import store from './state/store';\nimport {default as Container, mapper} from './state/container';\n\nexport default {\n  store,\n  Container,\n  mapper\n};\n"],"names":["makeSubject","observers","Map","idPtr","callback","id","set","delete","args","forEach","store","state$","func","subscribe","mountPoint","payload","next","Container","preact","Component","update","bind","unsubscribe","props","forceUpdate","children","map","componentFunc","perf","keys","Perf","nextProps","some","key","mapper","propMappings","actionMappings","PerfComponent","Object","mapped","assign","entries","actions"],"mappings":";;;;;;AAAA,MAAMA,cAAc,MAAM;QAClBC,YAAY,IAAIC,GAAJ,EAAlB;MACIC,QAAQ,CAAZ;SACO;eACOC,QAAD,IAAc;YACjBC,KAAKF,KAAX;;gBAEUG,GAAV,CAAcD,EAAd,EAAkBD,QAAlB;aACO,MAAMH,UAAUM,MAAV,CAAiBF,EAAjB,CAAb;KALG;UAOC,gBAAa;wCAATG,IAAS;YAAA;;;gBACPC,OAAV,CAAkBL,YAAYA,SAAS,GAAGI,IAAZ,CAA9B;;GARJ;CAHF;;AAgBA,aAAe,YAAgB;MAAfE,KAAe,uEAAP,EAAO;;QACvBC,SAASX,aAAf;;SAEO;eACMY,QAAQD,OAAOE,SAAP,CAAiBD,IAAjB,CADd;SAEA,CAACE,UAAD,EAAaC,OAAb,KAAyB;YACtBD,UAAN,IAAoBC,OAApB;aACOC,IAAP;KAJG;SAMAF,cAAcJ,MAAMI,UAAN;GANrB;CAHF;;;;;;;;AChBA,AAEe,MAAMG,SAAN,SAAwBC,OAAOC,SAA/B,CAAyC;gBACxC;;SAEPC,MAAL,GAAc,KAAKA,MAAL,CAAYC,IAAZ,CAAiB,IAAjB,CAAd;;;uBAGmB;SACdC,WAAL,GAAmB,KAAKC,KAAL,CAAWb,KAAX,CAAiBG,SAAjB,CAA2B,KAAKO,MAAhC,CAAnB;;;yBAGqB;SAChBE,WAAL;;;WAGO;SACFE,WAAL;;;eAG0B;QAAnBC,QAAmB,QAAnBA,QAAmB;QAATf,KAAS,QAATA,KAAS;;WAExB;;;eAEagB,GAAT,CAAaC,iBAAiBA,cAAcjB,KAAd,CAA9B;KAHN;;;;AAUJ,MAAMkB,OAAO,CAACT,SAAD,EAAYU,IAAZ,KACX,MAAMC,IAAN,SAAmBZ,OAAOC,SAA1B,CAAoC;wBACZY,SAAtB,EAAiC;WACxBF,KAAKG,IAAL,CAAUC,OAAOF,UAAUE,GAAV,MAAmB,KAAKV,KAAL,CAAWU,GAAX,CAApC,CAAP;;;WAGO;WACA,oBAAC,SAAD,EAAe,KAAKV,KAApB,CAAP;;CAPN;;AAWO,MAAMW,SAAS,SAATA,MAAS;MAACC,YAAD,uEAAc,EAAd;MAAkBC,cAAlB,uEAAiC,EAAjC;SACpBjB,aAAa;UACLkB,gBAAgBT,KAAKT,SAAL,EAAgBmB,OAAOT,IAAP,CAAYM,YAAZ,CAAhB,CAAtB;WACO,WAAyB;UAAtBzB,KAAsB,SAAtBA,KAAsB;UAAZa,KAAY;;YACxBgB,SAASD,OAAOE,MAAP,CAAc,EAAd,EACb,GAAGF,OAAOG,OAAP,CAAeN,YAAf,EAA6BT,GAA7B,CAAiC;;;YAAEO,GAAF;YAAOrB,IAAP;eAAkB,EAAE,CAACqB,GAAD,GAAOrB,KAAKF,KAAL,CAAT,EAAlB;OAAjC,CADU,CAAf;;YAIMgC,UAAUJ,OAAOE,MAAP,CAAc,EAAd,EACd,GAAGF,OAAOG,OAAP,CAAeL,cAAf,EAA+BV,GAA/B,CAAmC;;;YAAEO,GAAF;YAAOrB,IAAP;eAAkB,EAAE,CAACqB,GAAD,GAAO;8CAAIzB,IAAJ;kBAAA;;;mBAAaI,KAAKF,KAAL,EAAY,GAAGF,IAAf,CAAb;WAAT,EAAlB;OAAnC,CADW,CAAhB;;aAIO,oBAAC,aAAD,eAAmB+B,MAAnB,EAA+BG,OAA/B,EAA4CnB,KAA5C,EAAP;KATF;GAHkB;CAAf;;ACvCP,WAAe;OAAA;WAAA;;CAAf;;;;"}