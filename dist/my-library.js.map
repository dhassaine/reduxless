{"version":3,"file":"my-library.js","sources":["../src/state/store.js","../src/state/container.js","../src/main.js"],"sourcesContent":["const makeSubject = () => {\n  const observers = new Map();\n  let idPtr = 0;\n  return {\n    subscribe: (callback) => {\n      const id = idPtr;\n      idPtr++;\n      observers.set(id, callback);\n      return () => observers.delete(id);\n    },\n    next: (...args) => {\n      observers.forEach(callback => callback(...args));\n    }\n  };\n};\n\nexport default (store = {}) => {\n  const state$ = makeSubject();\n\n  return {\n    subscribe: func => state$.subscribe(func),\n    set: (mountPoint, payload) => {\n      store[mountPoint] = payload;\n      state$.next();\n    },\n    get: mountPoint => store[mountPoint]\n  };\n};\n","import preact from 'preact';\n\nexport default class Container extends preact.Component {\n  constructor() {\n    super();\n    this.update = this.update.bind(this);\n  }\n\n  componentWillMount() {\n    this.unsubscribe = this.props.store.subscribe(this.update);\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe();\n  }\n\n  update() {\n    this.forceUpdate();\n  }\n\n  render({ children, store }) {\n    return (\n      <div>\n        {\n          children.map(componentFunc => componentFunc(store))\n        }\n      </div>\n    );\n  }\n}\n\nconst perf = (Component, keys) =>\n  class Perf extends preact.Component {\n    shouldComponentUpdate(nextProps) {\n      return keys.some(key => nextProps[key] !== this.props[key]);\n    }\n\n    render() {\n      return <Component {...this.props} />;\n    }\n  };\n\nexport const mapper = (propMappings={}, actionMappings={}) =>\n  Component => {\n    const PerfComponent = perf(Component, Object.keys(propMappings));\n    return ({ store, ...props }) => {\n      const mapped = Object.assign({},\n        ...Object.entries(propMappings).map(([key, func]) => ({ [key]: func(store) }))\n      );\n\n      const actions = Object.assign({},\n        ...Object.entries(actionMappings).map(([key, func]) => ({ [key]: (...args) => func(store, ...args) }))\n      );\n\n      return <PerfComponent {...mapped} {...actions} {...props} />;\n    };\n  };\n","import store from './state/store';\nimport {default as Container, mapper} from './state/container';\n\nexport default {\n  store,\n  Container,\n  mapper\n};\n"],"names":["makeSubject","observers","Map","idPtr","callback","id","set","delete","args","forEach","store","state$","subscribe","func","mountPoint","payload","next","Container","update","bind","unsubscribe","props","forceUpdate","children","map","componentFunc","preact","Component","perf","keys","nextProps","some","key","mapper","propMappings","actionMappings","PerfComponent","Object","mapped","assign","entries","actions"],"mappings":";;;;;;;;AAAA,IAAMA,cAAc,SAAdA,WAAc,GAAM;MAClBC,YAAY,IAAIC,GAAJ,EAAlB;MACIC,QAAQ,CAAZ;SACO;eACM,mBAACC,QAAD,EAAc;UACjBC,KAAKF,KAAX;;gBAEUG,GAAV,CAAcD,EAAd,EAAkBD,QAAlB;aACO;eAAMH,UAAUM,MAAV,CAAiBF,EAAjB,CAAN;OAAP;KALG;UAOC,gBAAa;wCAATG,IAAS;YAAA;;;gBACPC,OAAV,CAAkB;eAAYL,0BAAYI,IAAZ,CAAZ;OAAlB;;GARJ;CAHF;;AAgBA,aAAe,YAAgB;MAAfE,KAAe,uEAAP,EAAO;;MACvBC,SAASX,aAAf;;SAEO;eACM;aAAQW,OAAOC,SAAP,CAAiBC,IAAjB,CAAR;KADN;SAEA,aAACC,UAAD,EAAaC,OAAb,EAAyB;YACtBD,UAAN,IAAoBC,OAApB;aACOC,IAAP;KAJG;SAMA;aAAcN,MAAMI,UAAN,CAAd;;GANP;CAHF;;ICdqBG;;;uBACL;;;;;UAEPC,MAAL,GAAc,MAAKA,MAAL,CAAYC,IAAZ,OAAd;;;;;;yCAGmB;WACdC,WAAL,GAAmB,KAAKC,KAAL,CAAWX,KAAX,CAAiBE,SAAjB,CAA2B,KAAKM,MAAhC,CAAnB;;;;2CAGqB;WAChBE,WAAL;;;;6BAGO;WACFE,WAAL;;;;iCAG0B;UAAnBC,QAAmB,QAAnBA,QAAmB;UAATb,KAAS,QAATA,KAAS;;aAExB;;;iBAEac,GAAT,CAAa;iBAAiBC,cAAcf,KAAd,CAAjB;SAAb;OAHN;;;;EAnBmCgB,OAAOC;;AA6B9C,IAAMC,OAAO,SAAPA,IAAO,CAACD,SAAD,EAAYE,IAAZ;;;;;;;;;;;4CAEaC,SAFb,EAEwB;;;eACxBD,KAAKE,IAAL,CAAU;iBAAOD,UAAUE,GAAV,MAAmB,OAAKX,KAAL,CAAWW,GAAX,CAA1B;SAAV,CAAP;;;;+BAGO;eACA,oBAAC,SAAD,EAAe,KAAKX,KAApB,CAAP;;;;IANeK,OAAOC,SADf;CAAb;;AAWO,IAAMM,SAAS,SAATA,MAAS;MAACC,YAAD,uEAAc,EAAd;MAAkBC,cAAlB,uEAAiC,EAAjC;SACpB,qBAAa;QACLC,gBAAgBR,KAAKD,SAAL,EAAgBU,OAAOR,IAAP,CAAYK,YAAZ,CAAhB,CAAtB;WACO,iBAAyB;UAAtBxB,KAAsB,SAAtBA,KAAsB;UAAZW,KAAY;;UACxBiB,SAASD,OAAOE,MAAP,gBAAc,EAAd,wCACVF,OAAOG,OAAP,CAAeN,YAAf,EAA6BV,GAA7B,CAAiC;;YAAEQ,GAAF;YAAOnB,IAAP;;+CAAqBmB,GAArB,EAA2BnB,KAAKH,KAAL,CAA3B;OAAjC,CADU,GAAf;;UAIM+B,UAAUJ,OAAOE,MAAP,gBAAc,EAAd,wCACXF,OAAOG,OAAP,CAAeL,cAAf,EAA+BX,GAA/B,CAAmC;;YAAEQ,GAAF;YAAOnB,IAAP;;+CAAqBmB,GAArB,EAA2B;4CAAIxB,IAAJ;gBAAA;;;iBAAaK,uBAAKH,KAAL,SAAeF,IAAf,EAAb;SAA3B;OAAnC,CADW,GAAhB;;aAIO,oBAAC,aAAD,2BAAmB8B,MAAnB,EAA+BG,OAA/B,EAA4CpB,KAA5C,EAAP;KATF;GAHkB;CAAf;;ACvCP,WAAe;cAAA;sBAAA;;CAAf;;;;;;;;"}